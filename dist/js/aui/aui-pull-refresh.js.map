{"version":3,"sources":["aui/aui-pull-refresh.js"],"names":["window","touchYDelta","translateVal","firstTouchY","initialScroll","auiPullToRefresh","params","callback","this","extend","_init","isLoading","docElem","document","documentElement","win","width","innerWidth","height","innerHeight","isMoved","prototype","container","querySelector","friction","triggerDistance","self","loadingHtml","insertAdjacentHTML","addEventListener","ev","touchStart","touchMove","touchEnd","style","webkitTransitionDuration","transitionDuration","touchobj","changedTouches","parseInt","clientY","scrollY","preventDefault","moving","touchY","Math","pow","webkitTransform","transform","classList","add","remove","throttle","status","cancelLoading","pageYOffset","scrollTop","fn","delay","allowSample","e","setTimeout","winresize","resize","a","b","key","hasOwnProperty"],"mappings":"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","file":"aui-pull-refresh.js","sourcesContent":["/**\n * aui-pull-refresh.js\n * @author 流浪男\n * @todo more things to abstract, e.g. Loading css etc.\n * Licensed under the MIT license.\n * http://www.opensource.org/licenses/mit-license.php\n */\n(function(window) {\n\t'use strict';\n\t/**\n\t * Extend obj function\n\t *\n\t * This is an object extender function. It allows us to extend an object\n\t * by passing in additional variables and overwriting the defaults.\n\t */\n\tvar auiPullToRefresh = function (params,callback) {\n\t\tthis.extend(this.params, params);\n\t\tthis._init(callback);\n\t}\n\tvar touchYDelta;\n\tvar isLoading = false;\n\tvar docElem = window.document.documentElement,\n\t\tloadWrapH,\n\t\twin = {width: window.innerWidth, height: window.innerHeight},\n\t\twinfactor= 0.2,\n\t\ttranslateVal,\n\t\tisMoved = false,\n\t\tfirstTouchY, initialScroll;\n\tauiPullToRefresh.prototype = {\n\t\tparams: {\n            container: document.querySelector('.aui-refresh-content'),\n\t\t\tfriction: 2.5,\n\t\t\ttriggerDistance: 100,\n\t\t\tcallback:false\n        },\n        _init : function(callback) {\n\t\t\tvar self = this;\n\t\t\tvar loadingHtml = '<div class=\"aui-refresh-load\"><div class=\"aui-refresh-pull-arrow\"></div></div>';\n\t\t\tself.params.container.insertAdjacentHTML('afterbegin', loadingHtml);\n\t\t\tself.params.container.addEventListener('touchstart', function(ev){\n\t\t\t\tself.touchStart(ev)\n\t\t\t});\n\t\t\tself.params.container.addEventListener('touchmove', function(ev){\n\t\t\t\tself.touchMove(ev)\n\t\t\t});\n\t\t\tself.params.container.addEventListener('touchend', function(ev){\n\t\t\t\tself.touchEnd(ev,callback);\n\t\t\t});\n\t\t},\n\t\ttouchStart : function(ev) {\n\t\t\t// this.params.container.classList.remove(\"refreshing\");\n\t\t\tif (isLoading) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tisMoved = false;\n\t\t\tthis.params.container.style.webkitTransitionDuration =\n\t\t    this.params.container.style.transitionDuration = '0ms';\n\t\t\ttouchYDelta = '';\n\t\t\tvar touchobj = ev.changedTouches[0];\n\t\t\t// register first touch \"y\"\n\t\t\tfirstTouchY = parseInt(touchobj.clientY);\n\t\t\tinitialScroll = this.scrollY();\n\t\t},\n\t\ttouchMove : function (ev) {\n\t\t\tif (isLoading) {\n\t\t\t\tev.preventDefault();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar moving = function() {\n\t\t\t\tvar touchobj = ev.changedTouches[0], // reference first touch point for this event\n\t\t\t\t\ttouchY = parseInt(touchobj.clientY);\n\t\t\t\t\ttouchYDelta = touchY - firstTouchY;\n\t\t\t\tif ( self.scrollY() === 0 && touchYDelta > 0  ) {\n\t\t\t\t\tev.preventDefault();\n\t\t\t\t}\n\t\t\t\tif ( initialScroll > 0 || self.scrollY() > 0 || self.scrollY() === 0 && touchYDelta < 0 ) {\n\t\t\t\t\tfirstTouchY = touchY;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\ttranslateVal = Math.pow(touchYDelta, 0.85);\n\t\t\t\tself.params.container.style.webkitTransform = self.params.container.style.transform = 'translate3d(0, ' + translateVal + 'px, 0)';\n\t\t\t\tisMoved = true;\n\t\t\t\tif(touchYDelta > self.params.triggerDistance){\n\t\t\t\t\tself.params.container.classList.add(\"aui-refresh-pull-up\");\n\t\t\t\t\tself.params.container.classList.remove(\"aui-refresh-pull-down\");\n\t\t\t\t}else{\n\t\t\t\t\tself.params.container.classList.add(\"aui-refresh-pull-down\");\n\t\t\t\t\tself.params.container.classList.remove(\"aui-refresh-pull-up\");\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.throttle(moving(), 20);\n\t\t},\n\t\ttouchEnd : function (ev,callback) {\n\t\t\tvar self =this;\n\t\t\tif (isLoading|| !isMoved) {\n\t\t\t\tisMoved = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// 根据下拉高度判断是否加载\n\t\t\tif( touchYDelta >= this.params.triggerDistance) {\n\t\t\t\tisLoading = true; //正在加载中\n\t\t\t\tev.preventDefault();\n\t\t\t\tthis.params.container.style.webkitTransitionDuration =\n\t\t    \tthis.params.container.style.transitionDuration = '300ms';\n\t\t\t\tthis.params.container.style.webkitTransform =\n\t\t\t\tthis.params.container.style.transform = 'translate3d(0,60px,0)';\n\t\t\t\tdocument.querySelector(\".aui-refresh-pull-arrow\").style.webkitTransitionDuration =\n\t\t    \tdocument.querySelector(\".aui-refresh-pull-arrow\").style.transitionDuration = '0ms';\n\t\t\t\tself.params.container.classList.add(\"aui-refreshing\");\n\t\t\t\tif(callback){\n\t\t\t\t\tcallback({\n\t\t\t\t\t\tstatus:\"success\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tthis.params.container.style.webkitTransitionDuration =\n\t\t    \tthis.params.container.style.transitionDuration = '300ms';\n\t\t\t\tthis.params.container.style.webkitTransform =\n\t\t\t\tthis.params.container.style.transform = 'translate3d(0,0,0)';\n\t\t\t\tif(callback){\n\t\t\t\t\tcallback({\n\t\t\t\t\t\tstatus:\"fail\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tisMoved = false;\n\t\t\treturn;\n\t\t},\n\t\tcancelLoading : function () {\n\t\t\tvar self =this;\n\t\t\tisLoading = false;\n\t\t\tself.params.container.classList.remove(\"aui-refreshing\");\n\t\t\tdocument.querySelector(\".aui-refresh-pull-arrow\").style.webkitTransitionDuration =\n\t\t    \tdocument.querySelector(\".aui-refresh-pull-arrow\").style.transitionDuration = '300ms';\n\t\t\tthis.params.container.style.webkitTransitionDuration =\n\t\t    \tthis.params.container.style.transitionDuration = '0ms';\n\t\t\tself.params.container.style.webkitTransform =\n\t\t\tself.params.container.style.transform = 'translate3d(0,0,0)';\n\t\t\tself.params.container.classList.remove(\"aui-refresh-pull-up\");\n\t\t\tself.params.container.classList.add(\"aui-refresh-pull-down\");\n\t\t\treturn;\n\t\t},\n\t\tscrollY : function() {\n\t\t\treturn window.pageYOffset || docElem.scrollTop;\n\t\t},\n\t\tthrottle : function(fn, delay) {\n\t\t\tvar allowSample = true;\n\t\t\treturn function(e) {\n\t\t\t\tif (allowSample) {\n\t\t\t\t\tallowSample = false;\n\t\t\t\t\tsetTimeout(function() { allowSample = true; }, delay);\n\t\t\t\t\tfn(e);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\twinresize : function () {\n\t\t\tvar resize = function() {\n\t\t\t\twin = {width: window.innerWidth, height: window.innerHeight};\n\t\t\t};\n\t\t\tthrottle(resize(), 10);\n\t\t},\n\t\textend: function(a, b) {\n\t\t\tfor (var key in b) {\n\t\t\t  \tif (b.hasOwnProperty(key)) {\n\t\t\t  \t\ta[key] = b[key];\n\t\t\t  \t}\n\t\t  \t}\n\t\t  \treturn a;\n\t\t }\n\t}\n\twindow.auiPullToRefresh = auiPullToRefresh;\n\n})(window);"]}