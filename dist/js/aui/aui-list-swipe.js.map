{"version":3,"sources":["aui/aui-list-swipe.js"],"names":["window","firstTouchX","firstTouchY","firstTouch","firstTouchTime","touchXDelta","handleTranslateVal","friction","swipeHandle","btnWidth","isMoved","isOpened","auiListSwipe","callback","this","_init","prototype","self","addEventListener","event","setTranslate","classList","remove","target","document","parentNode","contains","changedTouches","clientX","clientY","timeStamp","className","indexOf","preventDefault","toggleEvents","element","setTransform","style","backgroundColor","nextSibling","querySelector","stopPropagation","offsetWidth","touchMoveObj","touchX","Math","pow","moveX","moveY","direction","getDirection","angle","getAngle","abs","screenX","touchEndObj","toucheEndX","x","y","toucheEndY","add","status","dom","console","log","el","value","webkitTransitionDuration","transitionDuration","webkitTransform","transform","getDistance","p1","p2","props","sqrt","z","round","asin","PI"],"mappings":"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","file":"aui-list-swipe.js","sourcesContent":["/**\n * aui-list-swipe.js 列表页滑动菜单\n * verson 0.0.3\n * @author 流浪男 && Beck\n * http://www.auicss.com\n * @todo more things to abstract, e.g. Loading css etc.\n * Licensed under the MIT license.\n * http://www.opensource.org/licenses/mit-license.php\n */\n (function(window) {\n\t\"use strict\";\n\tvar translateVal,\n\t\tfriction = 1,\n\t\tfirstTouchX,\n\t\tfirstTouchxy,\n\t\tfirstTouchY,\n\t\tfirstTouch,\n\t\tfirstTouchTime,\n\t\ttouchXDelta,\n\t\thandleTranslateVal;\n\tvar TranslateZero = \"translate3d(0,0,0)\",\n\t\tTranslateCent = \"translate3d(100%,0,0)\";\n\tvar swipeHandle = false,\n\t\tbtnWidth = false,\n\t\tswipeBtnsRight = false;\n\tvar isMoved = false,isOpened=false;\n\tvar d = false;\n\tvar auiListSwipe = function (callback) {\n\t\tthis._init(callback);\n\t}\n\tauiListSwipe.prototype = {\n\t\t// var self = this;\n\t\t_init: function(callback){\n\t\t\tvar self = this;\n\t\t\t// var d = document.querySelectorAll(\"selectors\")\n\t\t\twindow.addEventListener('touchstart', function(event){\n\t\t\t\t// 如果已经打开，将已经打开的关闭\n\t\t\t\tif(isOpened && swipeHandle){\n\t\t\t\t\t// isOpened = false;\n\t\t\t\t\tself.setTranslate(swipeHandle,\"0px\");\n\t\t\t\t\tswipeHandle.classList.remove(\"aui-swipe-opened\");\n\t\t\t\t\treturn;\n\t\t\t\t}else{\n\t\t\t\t\tvar target = event.target;\n\t\t\t\t\t// 过滤点击\n\t\t\t\t\tfor(; target && target !== document; target = target.parentNode){\n\t\t\t\t\t\t// console.log(target.classList)\n\t\t\t\t\t\tif (target.classList){\n\t\t\t\t\t\t\tif (target.classList.contains(\"aui-swipe-handle\")) {\n\t\t\t\t\t\t\t\tswipeHandle = target;\n\t\t\t\t\t\t\t\tfirstTouch = event.changedTouches[0];\n\t\t\t\t\t\t\t\tfirstTouchX = firstTouch.clientX;\n\t\t\t\t\t\t\t\tfirstTouchY = firstTouch.clientY;\n\t\t\t\t\t\t\t\tfirstTouchTime = event.timeStamp;\n\t\t\t\t\t\t\t\tif(swipeHandle.className.indexOf(\"aui-swipe-opened\") > -1){\n\t\t\t\t\t\t\t\t// \tconsole.log(1)\n\t\t\t\t\t\t\t\t\t// self.setTranslate(swipeHandle,\"0px\");\n\t\t\t\t\t\t\t\t\t// swipeHandle.classList.remove(\"aui-swipe-opened\");\n\t\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\t// setTimeout(function(){\n\t\t\t\t\t\t\t\t\t\tself.toggleEvents(swipeHandle,callback);\n\t\t\t\t\t\t\t\t\t// }, 100)\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// if(swipeHandle){\n\t\t\t\t// \tevent.preventDefault();\n\t\t\t\t// \tself.setTranslate(swipeHandle,\"0px\");\n\t\t\t\t// \tswipeHandle.classList.remove(\"aui-swipe-opened\");\n\t\t\t\t// \tswipeHandle = false;\n\t\t\t\t// \treturn;\n\t\t\t\t// }\n\t\t\t\t// isMoved = false;\n\t\t\t\t// swipeHandle = false;\n\t\t\t})\n\t\t},\n\t\ttoggleEvents:function(element,callback){\n\t\t\tif(!swipeHandle){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tself.setTransform(element,300);\n\t\t\telement.addEventListener('touchstart', function(event){\n\t\t\t\t// if(element.className.indexOf(\"aui-swipe-opened\") > -1){\n\t\t\t\t// \tself.setTranslate(element,\"0px\");\n\t\t\t\t// \telement.classList.remove(\"aui-swipe-opened\");\n\t\t\t\t// \treturn;\n\t\t\t\t// }\n\t\t\t\t//:active样式引起列表背景色冲突\n\n\t\t\t\telement.parentNode.style.backgroundColor = \"#ffffff\";\n\t\t\t\tif(!element.nextSibling)return;\n\t\t\t},false)\n\t\t\telement.addEventListener('touchmove', function(event){\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif(document.querySelector(\".aui-swipe-opened\")){\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tif(swipeHandle != document.querySelector(\".aui-swipe-opened\")){\n\t\t\t\t\t\tself.setTranslate(document.querySelector(\".aui-swipe-opened\"),\"0px\");\n\t\t\t        \tdocument.querySelector(\".aui-swipe-opened\").classList.remove(\"aui-swipe-opened\");\n\t\t\t        \tisOpened = false;\n\t\t\t        \tevent.stopPropagation()\n\t\t\t        \treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// self.getAngle(event)\n\t\t\t\tself.setTransform(element,0);\n\t\t\t\t// if(element.className.indexOf(\"aui-swipe-opened\") > -1)return;\n\n\t\t\t\tif(element.parentNode.querySelector(\".aui-swipe-btn\")){\n\t\t\t\t\tbtnWidth = element.parentNode.querySelector(\".aui-swipe-btn\").offsetWidth;\n\t\t\t\t}\n\t\t\t\t// 列表触摸滑动时如果有已经显示的将其关闭，并退出。\n\t\t\t\tvar touchMoveObj = event.changedTouches[0],\n\t\t\t\t\ttouchX = touchMoveObj.clientX;\n\t\t\t\ttouchXDelta = -Math.pow(firstTouchX-touchX, 0.85);\n\t\t\t\thandleTranslateVal = touchXDelta/friction;\n\t\t\t\t// touchXDelta = touchX - firstTouchX;\n\t\t\t\t// handleTranslateVal = touchXDelta/0.15;\n\t\t\t\t// console.log(handleTranslateVal)\n\t\t        var moveX = touchMoveObj.clientX - firstTouchX;\n\t\t        var moveY = touchMoveObj.clientY - firstTouchY;\n\t\t        var direction = self.getDirection(moveX,moveY);\n\t\t        var angle = self.getAngle(Math.abs(moveX),Math.abs(moveY));\n\t\t        // console.log(isMoved);\n\n\t\t        // // 解决滑动屏幕返回时事件冲突，主要针对部分特殊机型\n\t\t        // if(touchMoveObj.screenX < 0){\n\t\t        // \tfirstTouchxy = '';\n\t\t        // }\n\t\t        if(direction == \"right\"){\n\t\t        \tisMoved = false;\n\t\t        \tevent.preventDefault();\n\t\t        }\n\t\t        if(direction == \"top\" || direction == \"down\"){\n\t\t        \tisMoved = false;\n\t\t        \treturn;\n\t\t        }\n\t\t        if(angle <= 15 && direction === 'left'){\n\t\t        \tevent.preventDefault()\n\t\t        \tisMoved = true;\n\t\t        }\n\t\t        // console.log(handleTranslateVal)\n\t\t        // if(isMoved)self.setTranslate(element,\"\"+(handleTranslateVal+10)+\"px\");\n\t\t        if((event.timeStamp - firstTouchTime) >= 100 && touchXDelta < 0 && touchMoveObj.screenX > 0 && isMoved){\n\t\t        \t// event.stopPropagation();\n\t\t        \t// element.classList.add(\"aui-swipe-moving\");\n\t\t        \t// event.preventDefault();\n\t\t        \tif(element.className.indexOf(\"aui-swipe-opened\") <= -1){\n\t\t\t\t\t\tif((handleTranslateVal+10) > -btnWidth){\n\t\t\t\t        \tself.setTranslate(element,\"\"+(handleTranslateVal+10)+\"px\");\n\t\t\t\t        }\n\t\t\t\t\t}else{\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t    }\n\t\t\t},false)\n\t\t\telement.addEventListener('touchend', function(event){\n\t\t\t\tself.setTransform(element,300);\n\t\t\t\tvar touchEndObj = event.changedTouches[0];\n\t\t\t\tvar touchEndxy = {\n\t\t\t\t\t\tx: touchEndObj.clientX || 0,\n\t\t\t\t\t\ty: touchEndObj.clientY || 0\n\t\t\t\t\t};\n\t\t\t\tvar toucheEndX = touchEndObj.clientX - firstTouchX;\n\t\t        var toucheEndY = touchEndObj.clientY - firstTouchY;\n\t\t        var direction = self.getDirection(toucheEndX,toucheEndY);\n\t\t        // element.classList.remove(\"aui-swipe-moving\");\n\t        \tif(direction=='left' && handleTranslateVal < (-btnWidth/3) && isMoved){\n\t\t        \tself.setTranslate(element,\"\"+-btnWidth+\"px\");\n\t\t        \telement.classList.add(\"aui-swipe-opened\");\n\t\t        \tcallback({\n\t\t        \t\t'status':true,\n\t\t        \t\t'dom':element\n\t\t        \t})\n\t\t        \t// isOpened = true;\n\t\t\t\t}else{\n\t\t\t\t\telement.classList.remove(\"aui-swipe-opened\");\n\t\t        \tself.setTranslate(element,\"0px\");\n\t\t        \tisOpened = false;\n\t\t\t\t}\n\t\t\t\t// isMoved = false;\n\t\t\t\tconsole.log(isOpened)\n\t\t\t},true)\n\t\t},\n\t\tsetTransform : function (el,value){\n\t\t\tel.style.webkitTransitionDuration = el.style.transitionDuration = value+'ms';\n\t\t},\n\t\tsetTranslate : function (el,value){\n\t\t\tif(el)el.style.webkitTransform = el.style.transform = \"translate3d(\"+value+\",0,0)\";\n\t\t},\n\t\tgetDistance : function(p1, p2, props) {\n\t\t\tif (!props) { props = ['x', 'y'];}\n\t\t\tvar x = p2[props[0]] - p1[props[0]];\n\t\t\tvar y = p2[props[1]] - p1[props[1]];\n\t\t\treturn Math.sqrt((x * x) + (y * y));\n\t\t},\n\t\tgetAngle:function(moveX, moveY){\n\t\t       // var x = Math.abs(x1 - x2);\n\t\t       // var y = Math.abs(y1 - y2);\n\t\t       var z = Math.sqrt(moveX*moveX + moveY*moveY);\n\t\t       return  Math.round((Math.asin(moveY / z) / Math.PI*180));\n\t\t},\n\t\tgetDirection : function(x, y) {\n\t\t\tif (x === y) { return '';}\n\t\t\tif (Math.abs(x) >= Math.abs(y)) {\n\t            return x > 0 ? 'right' : 'left';\n\t        } else {\n\t           \treturn y > 0 ? 'down' : 'up';\n\t        }\n\t\t}\n\t}\n\twindow.auiListSwipe = auiListSwipe;\n})(window);"]}